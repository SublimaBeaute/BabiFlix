<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Babi-Flix - Version Finale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
body,html{width:100%;height:100%;background:#000;color:#fff}
header{background:#000;color:red;font-size:24px;font-weight:bold;text-align:center;padding:15px;border-bottom:1px solid #222}

#overlay{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:9999;overflow:hidden}

#overlay iframe{
  position:absolute;
  top:-220px;
  left:0;
  width:100%;
  height:calc(100% + 220px);
  border:none;
}

.close-btn{
  position:absolute;
  top:10px;
  right:10px;
  background:red;
  color:white;
  border:none;
  padding:10px 15px;
  border-radius:5px;
  font-size:16px;
  z-index:10001;
}

#loader{
  position:absolute;
  width:100%;
  height:100%;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:white;
  z-index:10000
}
#progress{margin-top:15px;font-size:20px}

.films-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;padding:15px}
.film{background:#111;border-radius:10px;overflow:hidden;cursor:pointer;transition:.3s;position:relative}
.film:hover{transform:scale(1.05);box-shadow:0 0 15px red}
.film img{width:100%;height:250px;object-fit:cover}
.film-info{
  position:absolute;
  bottom:0;
  background:rgba(0,0,0,.7);
  width:100%;
  padding:10px;
  font-size:13px;
  opacity:0;
  transition:.3s
}
.film:hover .film-info{opacity:1}
</style>
</head>

<body>

<header>BABI-FLIX</header>

<div id="overlay">
  <div id="loader">
    <div>Chargement du film...</div>
    <div id="progress">0%</div>
  </div>
  <button class="close-btn" onclick="closeOverlay()">X</button>
  <iframe id="player" allow="autoplay; fullscreen"></iframe>
</div>

<div class="films-container" id="films"></div>

<script>
const JSON_URL = "https://script.google.com/macros/s/AKfycbw8wo-q79mnWgnHZQXxqU07EVIVbSFfj3onOal23oC7LJTgyZnhm1a452bwUTuU3Eoj/exec";

async function verifierCodeInstant(){
  const code = localStorage.getItem("babi_code");
  if(!code){window.location.href="acces.html";return false}
  const res = await fetch(JSON_URL);
  const data = await res.json();
  if(!data[code]){
    alert("Votre code n'est plus valide !");
    localStorage.removeItem("babi_code");
    window.location.href="acces.html";
    return false;
  }
  return true;
}
verifierCodeInstant();

/* ✅ 10 FILMS EXACTEMENT */
const films = [
{
 titre:"Titanic",
 image:"titanic.jpg",
 youtube:"https://odysee.com/$/embed/@TicTac:8/Titanic-Streaming-VF-Film-Complet-Gratuit---Top-Film-Streaming:6",
 description:"Une romance tragique entre deux jeunes issus de classes sociales opposées à bord du paquebot Titanic. Un film mythique mêlant amour, drame et catastrophe historique."
},
{
 titre:"Film 2 - Action Extrême",
 image:"film2.jpg",
 youtube:""https://odysee.com/$/embed/@survivalistegun:1/l'avant-veille-de-noël-film-complet-en:a"",
 description:"Un ancien agent spécial reprend du service pour sauver sa famille prise en otage par un cartel dangereux."
},
{
 titre:"Film 3 - La Dernière Chance",
 image:"film3.jpg",
 youtube:"https://example.com",
 description:"Un homme condamné à tort tente de prouver son innocence avant son exécution imminente."
},
{
 titre:"Film 4 - Amour Interdit",
 image:"film4.jpg",
 youtube:"https://example.com",
 description:"Deux jeunes amoureux issus de familles rivales luttent pour vivre leur amour contre tous."
},
{
 titre:"Film 5 - Mission Secrète",
 image:"film5.jpg",
 youtube:"https://example.com",
 description:"Une équipe d’élite est envoyée en mission ultra confidentielle dans une zone de guerre."
},
{
 titre:"Film 6 - Survivants",
 image:"film6.jpg",
 youtube:"https://example.com",
 description:"Après un crash d’avion, des survivants doivent s’unir pour rester en vie dans une jungle hostile."
},
{
 titre:"Film 7 - Le Hacker",
 image:"film7.jpg",
 youtube:"https://example.com",
 description:"Un jeune prodige de l’informatique est traqué après avoir découvert un complot mondial."
},
{
 titre:"Film 8 - Terreur Nocturne",
 image:"film8.jpg",
 youtube:"https://example.com",
 description:"Dans une petite ville, d’étranges disparitions surviennent chaque nuit."
},
{
 titre:"Film 9 - Destin Brisé",
 image:"film9.jpg",
 youtube:"https://example.com",
 description:"Un boxeur prometteur voit sa carrière ruinée après un drame inattendu."
},
{
 titre:"Film 10 - L’Ultime Combat",
 image:"film10.jpg",
 youtube:"https://example.com",
 description:"Deux frères ennemis s’affrontent dans un combat décisif pour sauver leur honneur."
}
];

const container=document.getElementById("films");
const overlay=document.getElementById("overlay");
const player=document.getElementById("player");
const loader=document.getElementById("loader");
const progress=document.getElementById("progress");

function openOverlay(film){
  verifierCodeInstant().then(valid=>{
    if(!valid)return;

    overlay.style.display="block";
    loader.style.display="flex";
    progress.textContent="0%";

    let p=0;
    const loading=setInterval(()=>{
      p+=4;
      progress.textContent=p+"%";
      if(p>=100){
        clearInterval(loading);
        loader.style.display="none";

        setTimeout(()=>{
          if(screen.orientation && screen.orientation.lock){
            screen.orientation.lock("landscape").catch(()=>{});
          }
        },300);
      }
    },100);

    player.src = film.youtube + "?autoplay=1";
  });
}

function closeOverlay(){
  overlay.style.display="none";
  player.src="";
  if(screen.orientation && screen.orientation.unlock){
    screen.orientation.unlock();
  }
}

films.forEach(film=>{
  const div=document.createElement("div");
  div.className="film";
  const img=document.createElement("img");
  img.src=film.image;
  const info=document.createElement("div");
  info.className="film-info";
  info.innerHTML=`<strong>${film.titre}</strong><br>${film.description}`;
  div.appendChild(img);
  div.appendChild(info);
  div.onclick=()=>openOverlay(film);
  container.appendChild(div);
});
</script>

</body>
</html>
